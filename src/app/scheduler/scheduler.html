<div class="scheduler-wrapper">
  <!-- Timescale dropdown -->
  <div class="timescale-dropdown">
    <select [value]="timescale()" (change)="changeTimescale($any($event.target).value)" class="timescale-select">
      <option [value]="Timescale.Hour">Hour</option>
      <option [value]="Timescale.Day">Day</option>
      <option [value]="Timescale.Week">Week</option>
      <option [value]="Timescale.Month">Month</option>
    </select>
  </div>

  <!-- Error message -->
  @if (errorMessage()) {
    <div class="error-message">
      {{ errorMessage() }}
    </div>
  }

  <div class="scheduler-container">
    <div
      #scrollElement
      class="scroll-container"
    >
      <div class="virtual-content" [style.width.px]="virtualizer.getTotalSize()">
        <!-- Date columns with headers -->
        @for (item of virtualizer.getVirtualItems(); track item.index) {
          <div
            class="date-column"
            [style.transform]="'translateX(' + item.start + 'px)'"
            [style.width.px]="item.size"
          >
            <div class="column-header">
              {{ getDateForColumn(item.index).label }}
            </div>
          </div>
        }

        <!-- Work center rows -->
        <div class="work-center-rows-container">
          @for (workCenter of workCenters(); track workCenter.id; let workCenterIndex = $index) {
            <div class="work-center-row-container" [style.top.px]="getWorkCenterRowTop(workCenterIndex)">
              @for (workOrder of getWorkOrdersForWorkCenter(workCenter.id); track workOrder.id) {
                <div
                  class="task-wrapper"
                  [style.left.px]="getTaskLeft(workOrder)"
                  [style.width.px]="getTaskWidth(workOrder)"
                >
                  <app-task
                    [workOrder]="workOrder"
                    [workCenter]="workCenter"
                    (edit)="onEditWorkOrder(workOrder)"
                    (delete)="onDeleteWorkOrder(workOrder)"
                  ></app-task>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Interaction pane - fixed above scrollable content -->
    <div
      class="interaction-pane"
      (mousemove)="onMouseMove($event)"
      (mouseleave)="onMouseLeave()"
      (click)="onClick($event)"
    >
      <!-- Row hover effect -->
      @if (showHoverEffect() && hoveredWorkCenterId()) {
        <div
          class="row-hover-effect"
          [style.top.px]="getRowHoverTop()"
        ></div>
      }

      <!-- Mouse position hover effect -->
      @if (showHoverEffect()) {
        <div
          class="mouse-hover-effect"
          [style.left.px]="mouseX()"
          [style.top.px]="getMouseHoverTop()"
        ></div>
      }
    </div>

    <!-- Work center overlay -->
    <app-work-center-overlay></app-work-center-overlay>
  </div>

  <!-- Work Order Details Sidebar -->
  @if (showWorkOrderDetails()) {
    <app-work-order-details
      [workOrder]="selectedWorkOrder()"
      [workCenterId]="selectedWorkCenterId()"
      (close)="onCloseDetails()"
    ></app-work-order-details>
  }
</div>
